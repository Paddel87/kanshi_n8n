<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Kanshi Media Ingestion</title>
<style>
body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
#drop-zone { border: 2px dashed #ccc; width: 420px; height: 220px; margin: 40px auto; display: flex; align-items: center; justify-content: center; cursor: pointer; border-radius: 8px; }
#drop-zone.dragover { border-color: #007bff; background: #f4f8ff; }
#progress { width: 420px; margin: 16px auto; height: 10px; background: #eee; border-radius: 6px; overflow: hidden; }
#bar { height: 100%; width: 0%; background: #007bff; transition: width 0.2s ease; }
#result { max-width: 640px; margin: 20px auto; text-align: left; }
.item { padding: 10px; border: 1px solid #ddd; border-radius: 6px; margin-bottom: 8px; }
.name { font-weight: bold; }
</style>
</head>
<body>
<h1>Media Drag & Drop Ingestion</h1>
<p>Ziehe Videos/Bilder hierher. Upload geht an n8n, Analyse via Grok, Ergebnis wird als JSON gespeichert.</p>
<div id="drop-zone">Dateien hierher ziehen oder klicken</div>
<input id="file-input" type="file" multiple accept="image/*,video/*" style="display:none;" />
<div id="progress"><div id="bar"></div></div>
<div id="result"></div>
<script>
const dz = document.getElementById('drop-zone');
const fi = document.getElementById('file-input');
const bar = document.getElementById('bar');
const result = document.getElementById('result');

dz.addEventListener('click', () => fi.click());
dz.addEventListener('dragover', e => { e.preventDefault(); dz.classList.add('dragover'); });
dz.addEventListener('dragleave', () => dz.classList.remove('dragover'));
dz.addEventListener('drop', e => { e.preventDefault(); dz.classList.remove('dragover'); uploadFiles(e.dataTransfer.files); });
fi.addEventListener('change', e => uploadFiles(e.target.files));

function uploadFiles(files) {
  Array.from(files).forEach(file => {
    const form = new FormData();
    form.append('file', file);
    form.append('filename', file.name);
    const xhr = new XMLHttpRequest();
    xhr.open('POST', 'http://localhost:5678/webhook/ingest');
    xhr.upload.onprogress = e => { if (e.lengthComputable) bar.style.width = ((e.loaded / e.total) * 100).toFixed(0) + '%'; };
    xhr.onload = () => {
      bar.style.width = '0%';
      const div = document.createElement('div');
      div.className = 'item';
      if (xhr.status === 200) {
        let data;
        try { data = JSON.parse(xhr.responseText); } catch { data = { raw: xhr.responseText }; }
        div.innerHTML = `<div class="name">${file.name}</div><div>Tags: ${(data.tags||[]).join(', ')}</div><div>Summary: ${data.summary||''}</div>`;
      } else {
        div.innerHTML = `<div class="name">${file.name}</div><div>Fehler: ${xhr.status}</div>`;
      }
      result.prepend(div);
    };
    xhr.onerror = () => { bar.style.width = '0%'; };
    xhr.send(form);
  });
}
</script>
</body>
</html>

