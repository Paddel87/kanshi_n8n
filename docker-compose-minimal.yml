version: '3.8'

services:
  # UI: NocoDB mit SQLite (JSON-ähnlich, no external DB)
  ui:
    image: nocodb/nocodb:latest
    restart: always
    ports:
      - "8080:8080"
    volumes:
      - nocodb_data:/usr/app/data  # SQLite persistent
    environment:
      NC_DISABLE_TELEMETRY: true  # Privacy

  # Workflow-Engine: Custom n8n (FFmpeg/ONNX, connect to NocoDB SQLite via SQL-Node)
  n8n:
    build: .  # Dockerfile für FFmpeg/Python/ONNX
    restart: always
    ports:
      - "5678:5678"
    volumes:
      - n8n_data:/home/node/.n8n
      - ./data:/home/node/files
      - ./workflows:/home/node/.n8n/workflows
    environment:
      N8N_HOST: localhost
      N8N_PORT: 5678
      N8N_PROTOCOL: http
      WEBHOOK_URL: http://localhost:5678/
      GENERIC_TIMEZONE: Europe/Berlin
      N8N_BASIC_AUTH_ACTIVE: true
      N8N_BASIC_AUTH_USER: admin
      N8N_BASIC_AUTH_PASSWORD: ${N8N_PASSWORD}
      GROK_API_KEY: ${GROK_API_KEY}  # Für HTTP-Node
    depends_on:
      - ui  # Optional, for later SQL to NocoDB SQLite

volumes:
  nocodb_data:
  n8n_data:
